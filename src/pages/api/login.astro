---
import { supabase } from "@lib/supabase";

let body = await Astro.request.json();

const {error, data} = await supabase.auth.setSession({
    access_token: body.access_token as string,
    refresh_token: body.refresh_token as string
  })
const {session, user} = data

if (error) return Astro.redirect("/login", 401)

if (session) Astro.cookies.set("session", JSON.stringify(session), { path: "/"})
if (user) Astro.cookies.set("user", JSON.stringify(user), { path: "/"})
if (session?.access_token) Astro.cookies.set("access_token", session.access_token, { path: "/"})

return Astro.redirect("/", 302)
---